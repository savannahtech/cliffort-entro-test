import { Queries, allQueryOptions } from '@/api/queries';
import { CreateEditTaskFormModal } from '@/components/createEditTaskFormModal';
import CustomButton from '@/components/customs/Button';
import { CustomLoader } from '@/components/customs/Loader';
import { TaskLists } from '@/components/taskLists';
import { FAILED_TO_FETCH_MESSAGE } from '@/constants';
import { TaskListType } from '@/types';
import { Stack, Typography } from '@mui/material';
import { AxiosError } from 'axios';
import { Inter } from 'next/font/google';
import Head from 'next/head';
import { useState } from 'react';
import { useQuery } from 'react-query';
import { toast } from 'react-toastify';

const inter = Inter({ subsets: ['latin'] });

const Tasks = () => {
	const {
		data: allTasks,
		isLoading: isLoadingTasks,
		error: tasksFetchingError,
	} = useQuery<TaskListType, AxiosError>('tasks', Queries.getAllTasks, allQueryOptions);
	const [isOpenCreateEditTaskForm, setIsOpenCreateEditTaskForm] = useState(false);

	if (tasksFetchingError) {
		toast.error(tasksFetchingError.message || FAILED_TO_FETCH_MESSAGE);
	}

	const toggleShowCreatEditTaskForm = () => {
		setIsOpenCreateEditTaskForm((prev) => !prev);
	};

	return (
		<>
			<Head>
				<title>List of Tasks</title>
				<meta name="description" content="Generated by create next app" />
				<meta name="viewport" content="width=device-width, initial-scale=1" />
			</Head>
			<main className={inter.className}>
				<Stack padding={4} direction={'column'} rowGap={3} width={'80%'}>
					<Stack direction={'row'} alignItems={'center'} gap={2}>
						<Typography variant="h5" fontSize={22} fontWeight={'600'}>
							Tasks
						</Typography>
						<CustomButton btnType="tertiary" btnText="New Task" onClick={toggleShowCreatEditTaskForm} />
					</Stack>
					<CustomLoader loading={isLoadingTasks} />
					{allTasks && allTasks.length ? <TaskLists taskLists={allTasks} /> : null}
					{}
				</Stack>
			</main>
			<CreateEditTaskFormModal isOpen={isOpenCreateEditTaskForm} handleCloseModal={toggleShowCreatEditTaskForm} />
		</>
	);
};

export default Tasks;
